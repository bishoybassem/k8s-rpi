- name: Create addons directory
  file:
    path: /etc/kubernetes/addons
    state: directory

- name: Copy dns addon
  template:
    src: coredns.yml.j2
    dest: /etc/kubernetes/addons/coredns.yml
    mode: 0644

- name: Create dns addon
  shell: kubectl create -f /etc/kubernetes/addons/coredns.yml
  register: kubectl_result
  changed_when: kubectl_result.rc == 0
  ignore_errors: yes