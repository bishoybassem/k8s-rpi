- name: Create addons directory
  file:
    path: /etc/kubernetes/addons
    state: directory

- name: Copy dns addon
  template:
    src: coredns.yml.j2
    dest: /etc/kubernetes/addons/coredns.yml
    mode: 0644

- name: Create dns addon
  shell: kubectl apply -f /etc/kubernetes/addons/coredns.yml

- name: Wait for coredns rollout
  shell: kubectl rollout status --namespace kube-system deployment/coredns
  changed_when: false